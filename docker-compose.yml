version: '3.8'

services:
  # ============================================================================
  # CLI Mode - Traditional command-line downloader (OPTIONAL - Advanced users)
  # ============================================================================
  # This service does NOT start by default (requires --profile cli flag)
  # Most users should use the WebGUI below which starts automatically
  # ============================================================================
  hianime-downloader:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        PUID: 1000
        PGID: 1000
    container_name: hianime-downloader
    environment:
      # Output directory (mounted below)
      OUTPUT_DIR: /downloads

      # Anime download configuration
      # LINK: https://hianime.to/watch/anime-name-12345
      # NAME: "Anime Title"
      # DOWNLOAD_TYPE: sub  # or 'dub'
      # EP_FROM: 1
      # EP_TO: 12
      # SEASON: 1
      # SERVER: HD-1

      # Options
      # NO_SUBTITLES: false
      # ARIA: false

      # Chrome settings
      CHROME_EXTRA_ARGS: ""
      # CHROME_PERSIST_PROFILE: false

      # Python settings
      PYTHONUNBUFFERED: 1
      PYTHONDONTWRITEBYTECODE: 1

    volumes:
      # Video file storage - mapped to your temp directory
      - /Users/benjamin/Documents/GitHub/temp:/downloads

      # Optional: Persistent Chrome profile storage
      - hianime-config:/config

    # Uncomment for interactive mode (when not using env vars)
    # stdin_open: true
    # tty: true

    restart: unless-stopped
    profiles: ["cli"]  # Only start with --profile cli

  # ============================================================================
  # WebGUI Mode - Web interface with background job processing (DEFAULT)
  # ============================================================================
  # This service STARTS AUTOMATICALLY when you run: docker-compose up -d
  # No additional steps, scripts, or service names needed!
  # Access the WebGUI at http://localhost:8080
  # ============================================================================
  hianime-webgui:
    image: ghcr.io/benjaminmue/hiani-dl:latest
    container_name: hianime-webgui
    entrypoint: ["/bin/bash", "/app/docker/webgui-entrypoint.sh"]
    environment:
      # Directories
      CONFIG_DIR: /config
      OUTPUT_DIR: /downloads

      # Web server settings
      WEB_PORT: 8080
      LOG_LEVEL: INFO

      # Timezone - Set to your region (e.g., Europe/Zurich, America/New_York, Asia/Tokyo)
      # This affects how dates/times are displayed in the WebGUI
      TZ: Europe/Zurich

      # Locale for date formatting (optional, defaults to timezone region)
      # Examples: de_CH (Swiss German), en_US (US English), fr_FR (French)
      LOCALE: de_CH.UTF-8

      # Security - URL allowlist (comma-separated domains)
      # For LAN/home use: List the domains you want to download from
      # For stricter control: Set specific domains only
      # Leave empty to allow all domains (less secure but convenient for home)
      URL_ALLOWLIST: "hianime.to"

      # Optional: Basic authentication (usually not needed on home LAN)
      # Only enable if multiple untrusted users share your network
      # WEB_USER: admin
      # WEB_PASSWORD: changeme

      # Chrome settings
      CHROME_EXTRA_ARGS: ""
      PYTHONUNBUFFERED: 1
      PYTHONDONTWRITEBYTECODE: 1

    volumes:
      # Video file storage - Change to your desired download path
      # See docker-compose-examples/ for platform-specific examples
      # Windows: C:/Users/YourUsername/Downloads/Anime:/downloads
      # macOS/Linux: ./downloads or /path/to/your/downloads
      - ./downloads:/downloads

      # Persistent config (database, logs) - Using named volume for portability
      - hianime-webgui-config:/config

    ports:
      - "8080:8080"

    restart: unless-stopped

    # Optional: Resource limits
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '2.0'
    #       memory: 2G
    #     reservations:
    #       memory: 512M

volumes:
  hianime-config:
    driver: local
  hianime-webgui-config:
    driver: local
